<!-- html5 skeleton -->
<!DOCTYPE html>
<html>

<head>
    <title>CONTACTS :: ProtoServer</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
    <h1>Hello World!</h1>
    <p>This is a proto app launcher...</p>

    <div id="logger"></div>

    <div>
        <fieldset>
            <input type="text" id="title" placeholder="title">
            <input type="text" id="msg" placeholder="message">
            <button id="sendNotif">send notificaton</button>
        </fieldset>
    </div>
</body>

</html>
<script src="../js/notif.js"></script>

<script>
    let title = document.getElementById("title").value
    let msg = document.getElementById("msg").value
    const phoneToken = "c677qUflSPa4gd_HY-Vmzc:APA91bFqfHRa3CmWif6W7qR0PwGF1m48cutZzklyNURed3nG_Bm0LBm7ByR_tQd5sHz43y0o3XWy1b4iJT7QdyGfaALSpZmJJ15NdoMU7zYNNtzu5EM1I1Y"

    document.getElementById("sendNotif").addEventListener("click", () => {
        console.log("clicked")
        sendNotification(phoneToken, title, msg)

        const auth = new GoogleAuth({
            keyFile: '../generate-token.js',
            scopes: ['https://www.googleapis.com/auth/cloud-platform'],
        });

        async function sendNotification(fcmToken, title, body) {
            const accessToken = await auth.getAccessToken();

            const response = await axios.post(
                `https://fcm.googleapis.com/v1/projects/84325436128/messages:send`,
                {
                    message: {
                        token: fcmToken, // The target device's registration token
                        notification: {
                            title: title,
                            body: body,
                        },
                    },
                },
                {
                    headers: {
                        Authorization: `Bearer ${accessToken}`, // OAuth 2.0 token
                        'Content-Type': 'application/json',
                    },
                }
            );

            console.log('Notification sent:', response.data);
        }
    })

</script>